### 反向代理
反向代理（Reverse Proxy）方式是指以代理服务器来接受Internet上的连接请求，然后将请求转发给内部网络上的服务器；并将从服务器上得到的结果返回给Internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。

讲到反向代理，我们就应该来讲讲什么事正向代理（代理）：通常的代理服务器，只用于代理内部网络对Internet的连接请求，客户机必须指定代理服务器,并将本来要直接发送到Web服务器上的http请求发送到代理服务器中。
![](https://github.com/4lQuiorrA/FE_Journey/blob/master/image/http/fanxiangdaili.png)

正向代理和反向代理什么意思呢？
我有时候，用自己的计算机A想访问国外的某个网站B，但是访问不了，此时，有一台中间服务器可以访问国外的网站B，那么我们可以用自己的电脑访问服务器C，通过C访问B这个网站。那么这个时候，服务器C可以被称为代理服务器，这种访问就叫正向代理。正向代理有一个特点，就是我们明确知道要访问哪个网站

当我们有个服务器集群，并且服务器集群中的每台服务器的内容一样的时候，同样我们要直接从个人电脑访问到服务器集群中的服务器的时候，无法访问，且此时有一个第三方服务器能访问集群，这个时候，我们通过第三方服务器访问服务器集群的内容，但是我们此时不知道是那一台服务器提供的内容，此时的代理方式称为方向代理。图所展现的就是反向代理的实现方法。

### 负载均衡

当一台服务器的单位时间内的访问量越大的时候，服务器的压力会越大。当一台服务器压力大的超过自身承受能力的时候，服务器就会崩溃。为了避免服务器的崩溃让用户有更好的体验，我们通常通过**负载均衡**的的方式来分担服务器的压力。那么什么是负载均衡？是这样的，我们可以建立很多很多个服务器，这些服务器组成一个服务器集群，然后当用户访问我们的网站的时候，先访问一个中间服务器，再让这个中间服务器再服务器集群中选择一个压力较小的服务器，然后将该访问请求引入该选择的服务器。这样用户每次访问都会保证服务器集群中的每一个服务器的压力趋于平衡，分担了服务器的压力，避免了服务器崩溃的情况。

负载均衡中用到一个技术：cdn技术。

![](https://github.com/4lQuiorrA/FE_Journey/blob/master/image/http/dailifuwuqi.png)

cdn技术用到一个**循环复用DNS**。通过这个转发到反向代理服务器，反向代理会判断一些资源，如果这些资源是经常访问的，就会放到缓存中，如果不是就会直接放到硬盘里面


## nginx 反向代理

#### upStream模块

Upstream模块是Nginx服务器的一个重要模块，Upstream模块实现在轮询和客户端IP之间实现后端的负载均衡

```
// 放到http{}里面
upstream test {
    ip_hash;

    server 192.168.0.1;
    server 192.168.0.2;
}
```
 1. 核心指令”ip_hash”只能在upstream {}中使用。这条指令用于通知nginx使用ip hash负载均衡算法。如果没加这条指令，nginx会使用默认的round robin负载均衡模块。请各位读者对比handler模块的配置，是不是有共同点？ 2. upstream {}中的指令可能出现在”server”指令前，可能出现在”server”指令后，也可能出现在两条”server”指令之间. server 后面跟的是ip地址。

 ```
 upstream test {
     ip_hash;
    server 192.168.0.1 weight=5;
    server 192.168.0.2 weight=7;
}
 ```
`weight = 5`代表的是意思是权重，就是这个服务器要使用的频率，这里面表示，请求12次，有5次要落到`192.168.0.1`,有7次要落到`192.168.0.2`

### 反向代理的作用

- 加密和SSL加速
- 负载均衡
- 缓存静态内容
- 压缩
- 减速上传
- 安全
- 外网发布

安全其实是相对安全，使用反向代理的时候，其实是在自己的服务器前面架设了另外一个服务器，然后通过这个服务器，进而将请求分发到自己的服务器上，如果黑客想攻击服务器，就必须攻击反向代理服务器，然后在攻击我们得服务器，这样就增加了攻击难度和时间，相对得增加了难度。

### nginx的安装

**linux centos**
[安装教程](https://www.cnblogs.com/wyd168/p/6636529.html)

踩坑

- 当配置好nginx时，需要关闭防火墙

```
// 临时关闭防火墙
systemctl stop firewalld  
// 永久关闭
systemctl disable firewalld 
```

**配置nginx常用命令**
- ps aux|grep node 查看某个应用的详细进程信息
- kill -9 pid 
- isof -i  tcp:8081